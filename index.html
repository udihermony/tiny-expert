<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#1a1a1a">
<title>Tiny Expert</title>
<link rel="manifest" href="manifest.json">
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Source+Serif+4:opsz,wght@8..60,400;8..60,600;8..60,700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg: #0f0f0f;
  --surface: #1a1a1a;
  --surface-2: #242424;
  --surface-3: #2e2e2e;
  --border: #333;
  --text: #e8e4dc;
  --text-dim: #8a8578;
  --text-muted: #5c5850;
  --accent: #c4a44a;
  --accent-dim: #8a7633;
  --warning: #c45a2a;
  --warning-bg: rgba(196, 90, 42, 0.1);
  --success: #4a8c5c;
  --tag-bg: rgba(196, 164, 74, 0.1);
  --radius: 12px;
  --radius-sm: 8px;
  --font-display: 'Source Serif 4', Georgia, serif;
  --font-mono: 'DM Mono', 'Courier New', monospace;
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
}

html, body {
  height: 100%;
  background: var(--bg);
  color: var(--text);
  font-family: var(--font-mono);
  font-size: 14px;
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
  overflow: hidden;
}

body {
  display: flex;
  flex-direction: column;
  padding-top: var(--safe-top);
  padding-bottom: var(--safe-bottom);
}

/* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
.header {
  padding: 16px 20px 12px;
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
}

.header-top {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 14px;
}

.logo {
  width: 32px;
  height: 32px;
  background: var(--accent);
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  flex-shrink: 0;
}

.app-title {
  font-family: var(--font-display);
  font-size: 20px;
  font-weight: 700;
  letter-spacing: -0.5px;
  color: var(--text);
}

.app-subtitle {
  font-size: 11px;
  color: var(--text-muted);
  letter-spacing: 1px;
  text-transform: uppercase;
  margin-left: auto;
}

/* ‚îÄ‚îÄ Search ‚îÄ‚îÄ */
.search-wrap {
  position: relative;
}

.search-input {
  width: 100%;
  padding: 12px 16px 12px 40px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  color: var(--text);
  font-family: var(--font-mono);
  font-size: 14px;
  outline: none;
  transition: border-color 0.2s, box-shadow 0.2s;
}

.search-input::placeholder {
  color: var(--text-muted);
}

.search-input:focus {
  border-color: var(--accent-dim);
  box-shadow: 0 0 0 3px rgba(196, 164, 74, 0.08);
}

.search-icon {
  position: absolute;
  left: 14px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-muted);
  font-size: 14px;
  pointer-events: none;
}

.clear-btn {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  background: var(--surface-2);
  border: none;
  color: var(--text-dim);
  width: 24px;
  height: 24px;
  border-radius: 50%;
  cursor: pointer;
  font-size: 12px;
  display: none;
  align-items: center;
  justify-content: center;
}

.clear-btn.visible { display: flex; }

/* ‚îÄ‚îÄ Category Tabs ‚îÄ‚îÄ */
.categories {
  display: flex;
  gap: 6px;
  padding: 12px 20px;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
  flex-shrink: 0;
  border-bottom: 1px solid var(--border);
}

.categories::-webkit-scrollbar { display: none; }

.cat-btn {
  padding: 6px 14px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 20px;
  color: var(--text-dim);
  font-family: var(--font-mono);
  font-size: 12px;
  white-space: nowrap;
  cursor: pointer;
  transition: all 0.2s;
  flex-shrink: 0;
}

.cat-btn:hover, .cat-btn.active {
  background: var(--tag-bg);
  border-color: var(--accent-dim);
  color: var(--accent);
}

/* ‚îÄ‚îÄ Results Area ‚îÄ‚îÄ */
.results {
  flex: 1;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  padding: 12px 16px 80px;
}

.results-info {
  font-size: 11px;
  color: var(--text-muted);
  padding: 4px 4px 12px;
  letter-spacing: 0.5px;
  text-transform: uppercase;
}

/* ‚îÄ‚îÄ Card ‚îÄ‚îÄ */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  margin-bottom: 10px;
  overflow: hidden;
  transition: border-color 0.2s;
}

.card:active {
  border-color: var(--accent-dim);
}

.card-header {
  padding: 14px 16px 10px;
  cursor: pointer;
  display: flex;
  align-items: flex-start;
  gap: 12px;
}

.card-icon {
  width: 36px;
  height: 36px;
  background: var(--surface-2);
  border-radius: var(--radius-sm);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  flex-shrink: 0;
  margin-top: 2px;
}

.card-meta { flex: 1; min-width: 0; }

.card-title {
  font-family: var(--font-display);
  font-size: 16px;
  font-weight: 600;
  line-height: 1.3;
  color: var(--text);
  margin-bottom: 4px;
}

.card-brief {
  font-size: 12px;
  color: var(--text-dim);
  line-height: 1.5;
}

.card-tags {
  display: flex;
  gap: 4px;
  flex-wrap: wrap;
  padding: 0 16px 12px;
}

.tag {
  font-size: 10px;
  padding: 2px 8px;
  background: var(--tag-bg);
  color: var(--accent);
  border-radius: 10px;
  letter-spacing: 0.3px;
}

.tag.difficulty-easy { background: rgba(74, 140, 92, 0.12); color: var(--success); }
.tag.difficulty-medium { background: rgba(196, 164, 74, 0.12); color: var(--accent); }
.tag.difficulty-hard { background: rgba(196, 90, 42, 0.12); color: var(--warning); }

.card-expand-icon {
  color: var(--text-muted);
  font-size: 12px;
  margin-top: 6px;
  transition: transform 0.3s;
  flex-shrink: 0;
}

.card.expanded .card-expand-icon {
  transform: rotate(180deg);
}

/* ‚îÄ‚îÄ Card Body (expanded) ‚îÄ‚îÄ */
.card-body {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s ease;
}

.card.expanded .card-body {
  max-height: 2000px;
}

.card-content {
  padding: 0 16px 16px;
  border-top: 1px solid var(--border);
}

.card-section-title {
  font-size: 11px;
  color: var(--text-muted);
  letter-spacing: 1px;
  text-transform: uppercase;
  margin: 14px 0 8px;
}

.card-steps {
  list-style: none;
  counter-reset: steps;
}

.card-steps li {
  counter-increment: steps;
  padding: 8px 0 8px 32px;
  position: relative;
  font-size: 13px;
  line-height: 1.6;
  color: var(--text);
  border-bottom: 1px solid rgba(255,255,255,0.03);
}

.card-steps li:last-child { border-bottom: none; }

.card-steps li::before {
  content: counter(steps);
  position: absolute;
  left: 0;
  top: 8px;
  width: 22px;
  height: 22px;
  background: var(--surface-2);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 11px;
  color: var(--accent);
  font-weight: 500;
}

.card-warning {
  margin-top: 12px;
  padding: 10px 12px;
  background: var(--warning-bg);
  border-left: 3px solid var(--warning);
  border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
  font-size: 12px;
  color: var(--warning);
  line-height: 1.5;
}

.card-warning::before {
  content: "‚ö† ";
}

.card-source {
  margin-top: 12px;
  font-size: 11px;
  color: var(--text-muted);
  font-style: italic;
}

/* ‚îÄ‚îÄ Empty State ‚îÄ‚îÄ */
.empty-state {
  text-align: center;
  padding: 60px 30px;
}

.empty-icon {
  font-size: 48px;
  margin-bottom: 16px;
  opacity: 0.4;
}

.empty-title {
  font-family: var(--font-display);
  font-size: 18px;
  color: var(--text-dim);
  margin-bottom: 8px;
}

.empty-sub {
  font-size: 12px;
  color: var(--text-muted);
  max-width: 240px;
  margin: 0 auto;
}

/* ‚îÄ‚îÄ Offline Badge ‚îÄ‚îÄ */
.offline-badge {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--surface-2);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 8px 16px;
  font-size: 11px;
  color: var(--success);
  display: flex;
  align-items: center;
  gap: 6px;
  z-index: 10;
  box-shadow: 0 4px 20px rgba(0,0,0,0.4);
}

.offline-dot {
  width: 6px;
  height: 6px;
  background: var(--success);
  border-radius: 50%;
}

/* ‚îÄ‚îÄ Animations ‚îÄ‚îÄ */
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.card { animation: fadeUp 0.3s ease backwards; }
.card:nth-child(2) { animation-delay: 0.05s; }
.card:nth-child(3) { animation-delay: 0.1s; }
.card:nth-child(4) { animation-delay: 0.15s; }
.card:nth-child(5) { animation-delay: 0.2s; }

/* ‚îÄ‚îÄ Scrollbar ‚îÄ‚îÄ */
.results::-webkit-scrollbar { width: 4px; }
.results::-webkit-scrollbar-track { background: transparent; }
.results::-webkit-scrollbar-thumb { background: var(--surface-3); border-radius: 2px; }
</style>
</head>
<body>

<div class="header">
  <div class="header-top">
    <div class="logo">üß≠</div>
    <div class="app-title">Tiny Expert</div>
    <div class="app-subtitle">Offline Survival</div>
  </div>
  <div class="search-wrap">
    <span class="search-icon">‚åï</span>
    <input type="text" class="search-input" id="searchInput" placeholder="Ask a survival question..." autocomplete="off" />
    <button class="clear-btn" id="clearBtn" onclick="clearSearch()">‚úï</button>
  </div>
</div>

<div class="categories" id="categories"></div>
<div class="results" id="results"></div>

<div class="offline-badge">
  <span class="offline-dot"></span>
  Works offline ¬∑ 20 cards loaded
</div>

<script>
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// KNOWLEDGE CARDS DATABASE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const CARDS = [
  // ‚îÄ‚îÄ WATER ‚îÄ‚îÄ
  {
    id: "water-solar-still",
    title: "Build a Solar Still",
    icon: "üíß",
    category: "water",
    brief: "Extract drinkable water from the ground using sunlight and a plastic sheet.",
    tags: ["no-tools", "desert", "tropical"],
    difficulty: "easy",
    steps: [
      "Dig a bowl-shaped hole about 3 feet wide and 2 feet deep in a sunny spot.",
      "Place a clean container (cup, bottle, etc.) at the center bottom of the hole.",
      "If available, place green vegetation or wet material around the container (not in it) to increase moisture.",
      "Cover the hole with a clear plastic sheet and seal the edges with rocks and soil.",
      "Place a small stone on the plastic directly above the container to create a low point.",
      "Wait 4‚Äì8 hours. Condensation will form on the underside of the plastic and drip into the container."
    ],
    warnings: ["Produces only 1‚Äì2 cups per day ‚Äî supplement with other water sources. Not sufficient as your sole water supply."],
    source: "US Army FM 21-76 Survival Manual"
  },
  {
    id: "water-boiling",
    title: "Purify Water by Boiling",
    icon: "üíß",
    category: "water",
    brief: "The most reliable field method to make water safe to drink.",
    tags: ["fire-required", "universal"],
    difficulty: "easy",
    steps: [
      "Collect water from the clearest source available. Flowing water is preferable to stagnant.",
      "If the water is visibly dirty, filter it first through cloth, sand, or a layered filter.",
      "Bring the water to a full rolling boil using any heat-safe container.",
      "Maintain the rolling boil for at least 1 minute (3 minutes above 6,500 ft / 2,000 m elevation).",
      "Let the water cool before drinking. Do not add anything to it.",
      "Store purified water in clean, covered containers."
    ],
    warnings: ["Boiling does NOT remove chemical pollutants, heavy metals, or salt. Only use with freshwater sources."],
    source: "WHO Guidelines for Drinking-water Quality"
  },
  {
    id: "water-find-sources",
    title: "Finding Water in the Wild",
    icon: "üíß",
    category: "water",
    brief: "How to locate water sources when none are immediately visible.",
    tags: ["no-tools", "universal"],
    difficulty: "medium",
    steps: [
      "Move downhill ‚Äî water flows to low points. Follow valleys, ravines, and dry streambeds.",
      "Look for green vegetation, especially in arid areas. Lush plants indicate underground water.",
      "Listen for running water ‚Äî even faint sounds can lead you to a stream.",
      "Watch animal behavior: birds flying low at dawn/dusk often head toward water. Insect swarms can indicate nearby water.",
      "Check rock crevices and depressions after rain ‚Äî they collect water naturally.",
      "In the morning, collect dew from grass and leaves by dragging a cloth through vegetation, then wring it out."
    ],
    warnings: ["Always purify any water you find before drinking, regardless of how clean it looks."],
    source: "SAS Survival Handbook ‚Äî John Wiseman"
  },
  // ‚îÄ‚îÄ FIRE ‚îÄ‚îÄ
  {
    id: "fire-bow-drill",
    title: "Start a Fire with a Bow Drill",
    icon: "üî•",
    category: "fire",
    brief: "A friction-based fire-starting method using a simple bow mechanism.",
    tags: ["no-modern-tools", "forest"],
    difficulty: "hard",
    steps: [
      "Carve a spindle: a straight, dry, softwood stick about 8 inches long and thumb-width thick.",
      "Make a fireboard: a flat, dry piece of the same softwood. Carve a small depression and cut a V-notch from the edge to the depression.",
      "Build a bow: a slightly curved stick about arm's length with a cord (shoelace, paracord, or plant fiber) tied taut between both ends.",
      "Find a handhold: a hard piece of wood, rock, or shell with a depression to hold the top of the spindle.",
      "Loop the bow string once around the spindle. Place the spindle on the fireboard depression.",
      "Press down on the handhold and saw the bow back and forth rapidly. Hot dust will collect in the V-notch.",
      "When you see smoke and a glowing ember in the notch, gently transfer the ember to a tinder bundle.",
      "Blow gently on the tinder bundle until it catches flame."
    ],
    warnings: ["This technique requires practice. Attempt it BEFORE an emergency. Wood selection is critical ‚Äî both pieces must be dry softwood (willow, cedar, cottonwood)."],
    source: "Bushcraft 101 ‚Äî Dave Canterbury"
  },
  {
    id: "fire-tinder-selection",
    title: "Best Natural Tinder Materials",
    icon: "üî•",
    category: "fire",
    brief: "What to gather first when starting a fire ‚Äî the most important step most people skip.",
    tags: ["no-tools", "universal", "forest"],
    difficulty: "easy",
    steps: [
      "Gather dry, fine materials FIRST. You need a golf-ball-sized bundle minimum.",
      "Best natural tinders: birch bark (curls of thin bark), dry grass bundled tightly, cattail fluff, cedar bark shredded finely, pine resin, dry dead leaves (crumbled).",
      "In wet conditions: look INSIDE standing dead wood ‚Äî the interior is often dry. Scrape fine shavings from the dry inner wood.",
      "Prepare your tinder into a loose \"bird's nest\" shape to allow airflow.",
      "Layer your fire setup: tinder (finest) ‚Üí kindling (pencil-thin sticks) ‚Üí fuel (wrist-thick wood).",
      "Always collect 3x more tinder than you think you need."
    ],
    warnings: ["Never use damp or green materials for tinder ‚Äî they produce smoke but no flame. If everything is wet, look for resinous wood (pine, spruce) which burns even when damp."],
    source: "Bushcraft 101 ‚Äî Dave Canterbury"
  },
  {
    id: "fire-safety-signal",
    title: "Build a Signal Fire",
    icon: "üî•",
    category: "fire",
    brief: "How to make a fire visible to search-and-rescue from a distance.",
    tags: ["rescue", "open-area"],
    difficulty: "medium",
    steps: [
      "Choose a highly visible location: hilltop, clearing, or shoreline.",
      "Build three fires in a triangle pattern, spaced about 100 feet apart ‚Äî this is the international distress signal.",
      "Build each fire normally, but keep green branches, wet leaves, or rubber/plastic nearby.",
      "When you hear or see aircraft, light all three fires quickly.",
      "Add green branches and wet material on top to generate thick white smoke (against dark background) or use oily materials for black smoke (against snow/sand).",
      "If you only have one fire, create intermittent smoke by covering and uncovering the fire with a wet blanket."
    ],
    warnings: ["Be extremely careful with signal fires in dry conditions ‚Äî you don't want to start a wildfire. Clear the area around each fire down to bare soil."],
    source: "US Army FM 21-76 Survival Manual"
  },
  // ‚îÄ‚îÄ SHELTER ‚îÄ‚îÄ
  {
    id: "shelter-debris-hut",
    title: "Build a Debris Hut",
    icon: "üèïÔ∏è",
    category: "shelter",
    brief: "A warm, insulated shelter built entirely from forest materials ‚Äî no tools needed.",
    tags: ["no-tools", "cold-weather", "forest"],
    difficulty: "medium",
    steps: [
      "Find a sturdy ridgepole: a fallen branch about 9‚Äì12 feet long that can support weight.",
      "Prop one end of the ridgepole on a stump, rock, or forked tree about 3 feet high. The other end rests on the ground.",
      "Lean sticks along both sides of the ridgepole at 45¬∞ angles, creating a ribcage frame. Space them 6‚Äì8 inches apart.",
      "Layer smaller sticks and brush across the ribs horizontally to create a lattice.",
      "Pile leaves, pine needles, grass, and debris over the lattice ‚Äî at least 2‚Äì3 feet thick. This is your insulation.",
      "Fill the inside floor with a thick layer of dry leaves or grass for insulation from the ground.",
      "Make the entrance small and consider blocking it with a stuff sack or more debris."
    ],
    warnings: ["Ground insulation is critical ‚Äî the cold ground steals more body heat than cold air. Use at least 6 inches of dry material under you."],
    source: "SAS Survival Handbook ‚Äî John Wiseman"
  },
  {
    id: "shelter-tarp-configs",
    title: "Tarp Shelter Configurations",
    icon: "üèïÔ∏è",
    category: "shelter",
    brief: "Four ways to set up a tarp for protection from rain, wind, and sun.",
    tags: ["tarp-required", "universal"],
    difficulty: "easy",
    steps: [
      "A-Frame: Run a ridgeline between two trees. Drape tarp over it and stake both sides to the ground. Best all-around setup for rain.",
      "Lean-To: Tie one edge of the tarp high between two trees. Stake the opposite edge to the ground at an angle. Good for reflecting fire heat toward you.",
      "C-Fly: Stake the rear edge to the ground, angle the tarp up and over using a ridgeline, and leave the front open. Good wind protection with fire access.",
      "Burrito: In heavy rain with no stakes, lay on one half of the tarp and fold the other half over you like a wrap. Emergency only ‚Äî no ventilation."
    ],
    warnings: ["Always pitch tarps at an angle so rain runs off. A flat tarp will pool water and eventually collapse."],
    source: "Bushcraft 101 ‚Äî Dave Canterbury"
  },
  // ‚îÄ‚îÄ FIRST AID ‚îÄ‚îÄ
  {
    id: "aid-bleeding-control",
    title: "Control Severe Bleeding",
    icon: "ü©π",
    category: "first-aid",
    brief: "Immediate steps to stop life-threatening blood loss in the field.",
    tags: ["critical", "no-tools", "universal"],
    difficulty: "medium",
    steps: [
      "Apply direct pressure immediately ‚Äî use any clean cloth, clothing, or even your bare hand.",
      "Press HARD and do not lift to check. Maintain constant, firm pressure for at least 10 minutes.",
      "If blood soaks through, add more material on top. Do NOT remove the original layer.",
      "If the wound is on a limb and direct pressure fails after 10 minutes, apply a tourniquet 2‚Äì3 inches above the wound (between the wound and the heart).",
      "Improvised tourniquet: use a belt, strip of cloth, or strap. Tighten by twisting with a stick (windlass) until bleeding stops.",
      "Note the time the tourniquet was applied. Do NOT remove it ‚Äî let medical professionals handle this.",
      "Keep the person warm, calm, and lying down. Elevate legs if possible to prevent shock."
    ],
    warnings: ["A tourniquet is painful and can damage the limb ‚Äî only use it when direct pressure fails and bleeding is life-threatening. Once applied, do not remove or loosen."],
    source: "TCCC Guidelines / Red Cross First Aid"
  },
  {
    id: "aid-hypothermia",
    title: "Treating Hypothermia",
    icon: "ü©π",
    category: "first-aid",
    brief: "Recognize and treat dangerous body temperature loss in the field.",
    tags: ["cold-weather", "critical"],
    difficulty: "medium",
    steps: [
      "Recognize the signs: shivering (early), confusion, slurred speech, clumsiness, drowsiness. If shivering STOPS in cold conditions, this is a medical emergency.",
      "Get the person out of the cold, wind, and wet immediately. Move to shelter.",
      "Remove all wet clothing. Replace with dry layers or wrap in blankets, sleeping bags, or dry materials.",
      "Insulate from the ground ‚Äî this is critical. Place them on a pad, branches, or dry leaves.",
      "Apply warmth to the core first: armpits, neck, groin. Use warm water bottles, heated rocks wrapped in cloth, or body-to-body heat.",
      "Give warm, sweet drinks if the person is conscious and able to swallow. No alcohol or caffeine.",
      "Handle gently ‚Äî rough movement can cause cardiac arrest in severely hypothermic people."
    ],
    warnings: ["Do NOT rub the skin, immerse in hot water, or apply direct heat to the extremities. This can cause dangerous heart rhythms. Warm the core first, slowly."],
    source: "Wilderness Medical Society Guidelines"
  },
  {
    id: "aid-sprains-fractures",
    title: "Splinting Sprains & Fractures",
    icon: "ü©π",
    category: "first-aid",
    brief: "Immobilize injured limbs when you can't get to medical care.",
    tags: ["injury", "universal"],
    difficulty: "medium",
    steps: [
      "Assess: Can they move the limb? Is there obvious deformity? Assume fracture if unsure.",
      "Do NOT try to straighten or realign a deformed limb.",
      "Find rigid splint material: straight sticks, trekking poles, rolled-up magazine or newspaper, SAM splint from first aid kit.",
      "Pad the splint with cloth or soft material to prevent pressure sores.",
      "Immobilize the joint ABOVE and BELOW the injury. For a forearm fracture, immobilize wrist and elbow.",
      "Secure the splint with strips of cloth, tape, belts, or cordage. Firm but not tight enough to cut off circulation.",
      "Check fingers/toes every 30 minutes: if they're blue, cold, or numb, loosen the bindings."
    ],
    warnings: ["Check for circulation (pulse, warmth, color) below the splint regularly. If circulation is compromised, loosen immediately."],
    source: "Red Cross Wilderness First Aid"
  },
  // ‚îÄ‚îÄ FOOD ‚îÄ‚îÄ
  {
    id: "food-universal-edibility",
    title: "Universal Edibility Test",
    icon: "üåø",
    category: "food",
    brief: "A systematic method to test whether an unknown plant is safe to eat.",
    tags: ["no-tools", "universal", "plants"],
    difficulty: "hard",
    steps: [
      "Test only one plant part at a time (leaf, stem, root, etc.). Fast for 8 hours before starting.",
      "Check for obvious danger signs: milky sap, thorns, almond smell, beans/bulbs, shiny leaves, umbrella-shaped flowers. Avoid these.",
      "Rub the plant part on your inner wrist. Wait 15 minutes. If irritation occurs, discard.",
      "Touch a small piece to the corner of your lip. Wait 15 minutes.",
      "Place a small piece on your tongue. Wait 15 minutes. Spit it out.",
      "Chew a small piece but do NOT swallow. Wait 15 minutes. If any burning, numbness, or bad reaction, spit out and rinse.",
      "Swallow a small amount. Wait 8 hours. If no ill effects, eat a small handful and wait another 8 hours.",
      "If still no reaction, this part of this plant is likely safe to eat in moderate amounts."
    ],
    warnings: ["This test takes 24+ hours. It is a LAST RESORT. Never use it on mushrooms ‚Äî many deadly mushrooms pass initial tests. Focus energy on trapping, fishing, or known-safe plants instead."],
    source: "US Army FM 21-76 Survival Manual"
  },
  {
    id: "food-trapping-basics",
    title: "Simple Snare Trap",
    icon: "üåø",
    category: "food",
    brief: "Build a basic snare to catch small game like rabbits and squirrels.",
    tags: ["wire-or-cord", "forest"],
    difficulty: "medium",
    steps: [
      "Make a snare loop from wire, paracord, or strong plant fiber. The loop should be about fist-sized (4‚Äì5 inches diameter) for rabbits.",
      "Tie a strong knot that creates a free-sliding loop ‚Äî when the animal pushes through, the loop tightens.",
      "Find an active game trail: look for tracks, droppings, compressed grass, or small tunnels through brush.",
      "Secure the free end of the snare firmly to a stake, tree, or heavy drag stick.",
      "Position the loop 3‚Äì4 inches off the ground for rabbits, at head height for the target animal.",
      "Place natural guides (sticks, rocks) to funnel the animal into the snare.",
      "Set 10‚Äì12 snares along trails to increase your odds. Check every 12‚Äì24 hours."
    ],
    warnings: ["Snares are indiscriminate ‚Äî check them frequently to minimize animal suffering. Be aware of local laws; snares may be illegal outside of survival emergencies. Setting many snares greatly increases success."],
    source: "SAS Survival Handbook ‚Äî John Wiseman"
  },
  {
    id: "food-insects",
    title: "Eating Insects for Survival",
    icon: "üåø",
    category: "food",
    brief: "Insects are the most accessible high-protein survival food almost everywhere.",
    tags: ["no-tools", "universal"],
    difficulty: "easy",
    steps: [
      "Safe and common edible insects: crickets, grasshoppers, ants, termites, grubs (beetle larvae), earthworms.",
      "AVOID brightly colored insects, hairy insects, insects with strong odors, and any insect you cannot identify.",
      "Always cook insects when possible ‚Äî roast on a hot rock or boil. This kills parasites and improves taste.",
      "Remove legs and wings from crickets and grasshoppers before eating (they can irritate the throat).",
      "Find them: look under rocks and logs (grubs, ants), in dead wood (termites, larvae), and in grass at dawn when they're sluggish.",
      "Ants can be collected by placing a stick near their trail and shaking them into water."
    ],
    warnings: ["Never eat ticks, flies, mosquitoes, or insects that feed on carrion or dung ‚Äî they carry disease. When in doubt, stick to grubs and crickets, which are safe almost universally."],
    source: "US Army FM 21-76 Survival Manual"
  },
  // ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ
  {
    id: "nav-no-compass",
    title: "Navigate Without a Compass",
    icon: "üß≠",
    category: "navigation",
    brief: "Multiple methods to determine direction using nature and the sky.",
    tags: ["no-tools", "universal"],
    difficulty: "medium",
    steps: [
      "Shadow stick method: Place a stick upright in the ground. Mark the tip of its shadow. Wait 15‚Äì30 minutes. Mark the new tip. A line between the marks runs roughly east‚Äìwest (first mark is west).",
      "Sun direction: The sun rises roughly east and sets roughly west. At midday in the northern hemisphere, it's due south; in the southern hemisphere, due north.",
      "Stars (Northern Hemisphere): Find the Big Dipper. The two stars at the end of the 'bowl' point toward Polaris (North Star). Walk toward it to go north.",
      "Stars (Southern Hemisphere): Find the Southern Cross. Extend the long axis 4.5 times its length downward. That point is roughly due south.",
      "Tree indicators (unreliable but useful in combination): moss tends to grow on the shadier side, branches may be fuller on the sunnier side.",
      "Wind patterns: In many regions, prevailing wind direction is consistent. Snow or sand dunes can indicate persistent wind direction."
    ],
    warnings: ["No single natural method is perfectly accurate. Use multiple methods together to confirm direction. Tree/moss indicators are the least reliable ‚Äî use only to supplement other methods."],
    source: "SAS Survival Handbook ‚Äî John Wiseman"
  },
  {
    id: "nav-stay-or-go",
    title: "Lost: Should You Stay or Move?",
    icon: "üß≠",
    category: "navigation",
    brief: "The most critical decision when you realize you're lost.",
    tags: ["universal", "critical", "no-tools"],
    difficulty: "easy",
    steps: [
      "STOP: Sit down. Do not panic. Do not keep walking hoping to find the way.",
      "STAY if: someone knows where you are and when you're expected back, you're near your vehicle or camp, terrain is dangerous or visibility is low, you're injured.",
      "GO if: no one knows your location, you have no chance of rescue, you are certain of a direction to safety, you have water and energy to travel.",
      "If you stay: make yourself visible. Lay out bright clothing, build a signal fire, use a whistle (3 blasts = distress). Stay near an open area where searchers can spot you.",
      "If you go: leave a note with your plan, date, direction, and condition. Mark your trail as you walk (stacked rocks, broken branches, arrows in dirt).",
      "In most cases, STAYING PUT is the safer choice if anyone knows your approximate location."
    ],
    warnings: ["The #1 cause of death in lost-person scenarios is continued movement in the wrong direction. When in doubt, stay and wait for rescue."],
    source: "National Park Service SAR Guidelines"
  },
  // ‚îÄ‚îÄ RESCUE ‚îÄ‚îÄ
  {
    id: "rescue-ground-signals",
    title: "Ground-to-Air Rescue Signals",
    icon: "üì°",
    category: "rescue",
    brief: "Standard symbols that search aircraft will recognize from the air.",
    tags: ["rescue", "open-area"],
    difficulty: "easy",
    steps: [
      "Make signals as LARGE as possible ‚Äî at least 10 feet long, ideally 30+ feet. They must be visible from altitude.",
      "Use contrast: dark materials on light ground (rocks on sand), or trample/dig into snow.",
      "Standard ICAO ground-to-air signals: V = Need assistance. X = Need medical help. ‚Üí (arrow) = Traveling this direction. ‚ñ° (square) = Need supplies. Y = Yes/affirmative. N = No/negative.",
      "The most important signal: a large X in an open area means 'need help' and is universally recognized.",
      "Use three of anything as a distress signal: three fires, three whistle blasts, three gunshots.",
      "Reflective signaling: use a mirror, phone screen, or any shiny surface to flash toward aircraft. Sweep the horizon regularly."
    ],
    warnings: ["Signals only work in open areas. Under tree canopy, focus on smoke, sound (whistle), and getting to a clearing."],
    source: "ICAO Annex 12 / US Army FM 21-76"
  },
  {
    id: "rescue-whistle-signals",
    title: "Distress Whistle Signals",
    icon: "üì°",
    category: "rescue",
    brief: "How to use sound to signal for rescue ‚Äî much more effective than shouting.",
    tags: ["whistle", "universal"],
    difficulty: "easy",
    steps: [
      "The international distress signal is 3 short blasts, pause, 3 short blasts. Repeat regularly.",
      "A whistle carries much further than the human voice ‚Äî up to a mile in good conditions vs. a few hundred yards for shouting.",
      "Blow in sets of three: 3 blasts, then pause 1 minute, then 3 more blasts.",
      "If you hear 2 blasts in response, rescuers have heard you and are coming.",
      "If you don't have a whistle, bang rocks together, strike a hollow log, or use any loud noise-maker in sets of three.",
      "Sound carries best across water and open terrain. Use elevated positions when possible."
    ],
    warnings: ["Conserve your energy ‚Äî blow the whistle rather than shouting, and rest between signal sets. Dehydration and exhaustion from yelling can worsen your situation."],
    source: "International Mountain Rescue Guidelines"
  },
  {
    id: "aid-water-crossing",
    title: "Safe River & Stream Crossing",
    icon: "üß≠",
    category: "navigation",
    brief: "How to cross moving water without being swept away.",
    tags: ["river", "travel", "universal"],
    difficulty: "hard",
    steps: [
      "Scout first: walk along the bank to find the widest, shallowest point. Fast and narrow is more dangerous than slow and wide.",
      "Unbuckle your pack's hip belt and sternum strap so you can ditch it if you fall.",
      "Use a sturdy stick (trekking pole) as a third point of contact, planted upstream.",
      "Face upstream at a slight angle. Move one foot at a time ‚Äî never have both feet moving.",
      "Shuffle sideways across the current. Do not cross your feet.",
      "In groups: link arms in a line perpendicular to the current, with the strongest person upstream.",
      "If swept off your feet: ditch your pack, roll onto your back, feet downstream to fend off rocks, and swim diagonally toward shore."
    ],
    warnings: ["Never cross water above knee-deep if the current is strong. Water only 6 inches deep moving fast can knock you down. If in doubt, find another crossing point or wait for water levels to drop."],
    source: "Mountaineering: Freedom of the Hills"
  }
];

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// CATEGORIES
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const CATEGORIES = [
  { id: "all", label: "All", icon: "‚óâ" },
  { id: "water", label: "Water", icon: "üíß" },
  { id: "fire", label: "Fire", icon: "üî•" },
  { id: "shelter", label: "Shelter", icon: "üèïÔ∏è" },
  { id: "first-aid", label: "First Aid", icon: "ü©π" },
  { id: "food", label: "Food", icon: "üåø" },
  { id: "navigation", label: "Navigation", icon: "üß≠" },
  { id: "rescue", label: "Rescue", icon: "üì°" },
];

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// SEARCH ENGINE (fuzzy keyword matching)
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function tokenize(text) {
  return text.toLowerCase().replace(/[^a-z0-9\s]/g, '').split(/\s+/).filter(t => t.length > 1);
}

// Simple TF-based scoring ‚Äî good enough for 20 cards
function scoreCard(card, queryTokens) {
  if (queryTokens.length === 0) return 0;

  const searchable = [
    card.title,
    card.brief,
    card.steps.join(' '),
    card.tags.join(' '),
    card.category,
    card.warnings.join(' ')
  ].join(' ').toLowerCase();

  const searchTokens = tokenize(searchable);
  let score = 0;

  for (const qt of queryTokens) {
    // Exact match
    for (const st of searchTokens) {
      if (st === qt) score += 3;
      else if (st.startsWith(qt)) score += 2;
      else if (st.includes(qt)) score += 1;
    }
    // Title bonus
    if (card.title.toLowerCase().includes(qt)) score += 5;
    // Tag bonus
    if (card.tags.some(t => t.includes(qt))) score += 3;
  }

  return score;
}

function search(query, category = 'all') {
  let filtered = category === 'all' ? CARDS : CARDS.filter(c => c.category === category);

  if (!query.trim()) return filtered;

  const tokens = tokenize(query);
  const scored = filtered.map(card => ({ card, score: scoreCard(card, tokens) }));
  return scored.filter(s => s.score > 0)
    .sort((a, b) => b.score - a.score)
    .map(s => s.card);
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// RENDERING
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let activeCategory = 'all';
let expandedCard = null;

function renderCategories() {
  const el = document.getElementById('categories');
  el.innerHTML = CATEGORIES.map(c =>
    `<button class="cat-btn ${c.id === activeCategory ? 'active' : ''}" onclick="setCategory('${c.id}')">${c.icon} ${c.label}</button>`
  ).join('');
}

function renderResults(cards) {
  const el = document.getElementById('results');

  if (cards.length === 0) {
    el.innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">üîç</div>
        <div class="empty-title">No cards found</div>
        <div class="empty-sub">Try different keywords or browse a category</div>
      </div>`;
    return;
  }

  const query = document.getElementById('searchInput').value;
  const info = query ? `${cards.length} result${cards.length !== 1 ? 's' : ''}` : `${cards.length} cards`;

  el.innerHTML = `<div class="results-info">${info}</div>` + cards.map(card => `
    <div class="card ${expandedCard === card.id ? 'expanded' : ''}" id="card-${card.id}">
      <div class="card-header" onclick="toggleCard('${card.id}')">
        <div class="card-icon">${card.icon}</div>
        <div class="card-meta">
          <div class="card-title">${card.title}</div>
          <div class="card-brief">${card.brief}</div>
        </div>
        <div class="card-expand-icon">‚ñæ</div>
      </div>
      <div class="card-tags">
        <span class="tag difficulty-${card.difficulty}">${card.difficulty}</span>
        ${card.tags.map(t => `<span class="tag">${t}</span>`).join('')}
      </div>
      <div class="card-body">
        <div class="card-content">
          <div class="card-section-title">Steps</div>
          <ol class="card-steps">
            ${card.steps.map(s => `<li>${s}</li>`).join('')}
          </ol>
          ${card.warnings.map(w => `<div class="card-warning">${w}</div>`).join('')}
          <div class="card-source">Source: ${card.source}</div>
        </div>
      </div>
    </div>
  `).join('');
}

function toggleCard(id) {
  expandedCard = expandedCard === id ? null : id;
  refresh();
  if (expandedCard) {
    setTimeout(() => {
      document.getElementById(`card-${id}`)?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }, 100);
  }
}

function setCategory(id) {
  activeCategory = id;
  expandedCard = null;
  renderCategories();
  refresh();
}

function refresh() {
  const query = document.getElementById('searchInput').value;
  const results = search(query, activeCategory);
  renderResults(results);
  document.getElementById('clearBtn').classList.toggle('visible', query.length > 0);
}

function clearSearch() {
  document.getElementById('searchInput').value = '';
  expandedCard = null;
  refresh();
  document.getElementById('searchInput').focus();
}

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ
document.getElementById('searchInput').addEventListener('input', () => {
  expandedCard = null;
  refresh();
});

renderCategories();
refresh();

// Register service worker for offline support
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js').catch(() => {});
}
</script>
</body>
</html>
